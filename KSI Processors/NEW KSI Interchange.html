<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>NEW KSI Interchange</title>
    <link rel="stylesheet" href="https://cdn.datatables.net/1.11.5/css/jquery.dataTables.min.css">
    <style>
        body {
            background-color: #B0B0B0;
            font-family: Arial, sans-serif;
        }
        .container {
            padding: 20px;
        }
        .logo {
            display: block;
            margin: 0 auto 20px auto;
            max-width: 100%;
            height: auto;
        }
        textarea {
            width: 100%;
            height: 150px;
            margin-bottom: 10px;
        }
        button {
            background-color: #de9b14;
            color: black;
            padding: 10px;
            border: none;
            cursor: pointer;
            margin-right: 10px;
        }
        table {
            width: 100%;
        }
    </style>
</head>
<body>
    <div class="container">
        <img src="C:/Users/USER/Downloads/Logo.png" alt="Logo" class="logo">
        <h2>Enter Product Interchange:</h2>
        <textarea id="productInfo"></textarea><br>
        <button onclick="processProductInfo()">Process</button>
        <button onclick="copyToClipboard('productTable')">Copy to Clipboard</button>
        <h2>Results:</h2>
        <table id="productTable" class="display">
            <thead>
                <tr>
                    <th>Partslink 1</th>
                    <th>Partslink 2 (With Certification)</th>
                    <th>Partslink 3</th>
                    <th>OE Number 1</th>
                    <th>OE Number 2</th>
                    <th>OE Number 3 (or remaining numbers)</th>
                    <th>Interchange Part Number 1</th>
                    <th>Interchange Part Number 2</th>
                    <th>Interchange Part Number 3 (or remaining numbers)</th>
                </tr>
            </thead>
            <tbody>
            </tbody>
        </table>
    </div>
    <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
    <script src="https://cdn.datatables.net/1.11.5/js/jquery.dataTables.min.js"></script>
    <script>
        function extractData(productInfo) {
            let data = {
                replacesOE: [],
                interchange: [],
                partslink: []
            };
            let lines = productInfo.trim().split("\n");
            let currentTitle = '';
            lines.forEach(line => {
                if (line.startsWith("Replaces OE Number")) {
                    data.replacesOE = [...new Set(lines[lines.indexOf(line) + 1].trim().split(", "))];
                } else if (line.startsWith("Interchange Part Number")) {
                    data.interchange = lines[lines.indexOf(line) + 1].trim().split(", ");
                } else if (line.startsWith("Replaces Partslink Number")) {
                    data.partslink = lines[lines.indexOf(line) + 1].trim().split(", ");
                }
            });
            return data;
        }

        function processProductInfo() {
            let rawText = document.getElementById("productInfo").value.trim();
            let productData = rawText ? extractData(rawText) : null;
            let result = productData ? formatResult(productData) : createEmptyResult();
            let productTable = $('#productTable').DataTable();
            productTable.clear().rows.add([result]).draw();
        }

function formatResult(data) {
    let result = [];
    let partslinkWithoutC = [];
    let partslinkWithC = [];

    // Remove duplicates from Partslink and split based on certification
    data.partslink = [...new Set(data.partslink)];
    data.partslink.forEach(part => {
        if (part.endsWith("C")) {
            partslinkWithC.push(part);
        } else {
            partslinkWithoutC.push(part);
        }
    });

    // Handle Partslink 1 and 2 (with certification)
    if (partslinkWithC.length > 0) {
        let basePart = partslinkWithC[0].slice(0, -1);
        result.push(basePart); // Partslink 1 (without C)
        result.push(partslinkWithC[0]); // Partslink 2 (with C)
        partslinkWithoutC = partslinkWithoutC.filter(part => part !== basePart); // Remove duplicates
    } else {
        result.push(partslinkWithoutC[0] || "N/A");
        result.push("N/A");
        partslinkWithoutC.shift(); // Remove the first item (already used)
    }

    result = result.concat(partslinkWithoutC.slice(0, 1)); // Add remaining Partslink numbers (limit to 1)

    for (let i = result.length; i < 3; i++) {
        result.push("N/A");
    }

    // Handle OE Numbers (remove duplicates and push to result)
    data.replacesOE = [...new Set(data.replacesOE)];
    for (let i = 0; i < 2; i++) {
        result.push(data.replacesOE[i] || "N/A");
    }

    result.push(data.replacesOE.slice(2).join(", ") || "N/A"); // Remaining OE Numbers (if any)

    // Remove duplicates from Interchange Part Numbers (don't show if already in Partslink or OE)
    let interchangeUnique = data.interchange.filter(item => 
        !data.replacesOE.includes(item) && 
        !data.partslink.includes(item) && 
        !data.partslink.includes(item + "C")
    );

    // Add Interchange Part Numbers (after filtering duplicates)
    result.push(interchangeUnique[0] || "N/A");
    result.push(interchangeUnique[1] || "N/A");
    result.push(interchangeUnique.slice(2).join(", ") || "N/A");

    return result;
}

        function createEmptyResult() {
            return Array(9).fill("N/A");
        }

        function copyToClipboard(tableId) {
            let table = $(`#${tableId}`).DataTable();
            let data = table.rows().data().toArray().map(row => row.join("\t")).join("\n");

            navigator.clipboard.writeText(data).then(() => {
                alert("Data copied to clipboard!");
            }).catch(() => {
                alert("Failed to copy data to clipboard.");
            });
        }

        $(document).ready(function () {
            $('#productTable').DataTable();
        });
    </script>
</body>
</html>
