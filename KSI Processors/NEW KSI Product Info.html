<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>USAUTO SET Info Processor</title>
    <link rel="stylesheet" href="https://cdn.datatables.net/1.11.5/css/jquery.dataTables.min.css">
    <style>
        body {
            background-color: #B0B0B0;
            font-family: Arial, sans-serif;
        }
        .container {
            padding: 20px;
        }
        .logo {
            display: block;
            margin: 0 auto 20px auto;
            max-width: 100%;
            height: auto;
        }
        textarea {
            width: 100%;
            height: 150px;
            margin-bottom: 10px;
        }
        button {
            background-color: #de9b14;
            color: black;
            padding: 10px;
            border: none;
            cursor: pointer;
            margin-right: 10px;
        }
        table {
            width: 100%;
        }
    </style>
</head>
<body>
    <div class="container">
        <img src="C:/Users/USER/Downloads/Logo.png" alt="Logo" class="logo">
        <h2>Enter Product Info:</h2>
        <textarea id="productInfo"></textarea><br>
        <button onclick="processProductInfo()">Process</button>
        <button onclick="copyToClipboard()">Copy to Clipboard</button>
        <table id="productTable" class="display">
            <thead>
                <tr>
                    <th>Certification</th>
                    <th>Part</th>
                    <th>Position</th>
                    <th>Material</th>
                    <th>Finish</th>
                    <th>Lens Color</th>
                    <th>Housing Color</th>
                    <th>Light Source</th>
                    <th>Assembly</th>
                    <th>Data 1</th>
                    <th>Data 2</th>
                    <th>Data 3</th>
                    <th>Data 4</th>
                    <th>Data 5</th>
                    <th>Data 6</th>
                    <th>Data 7</th>
                    <th>Data 8</th>
                    <th>Data 9</th>
                    <th>Data 10</th>
                    <th>Notes</th>
                    <th>Quantity Sold</th>
                </tr>
            </thead>
            <tbody>
            </tbody>
        </table>
    </div>
    <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
    <script src="https://cdn.datatables.net/1.11.5/js/jquery.dataTables.min.js"></script>
    <script>
        const excludedTitles = ["Brand", "Product Fit", "Recommended Use", "Prop 65 Warning", "Interchange Part Number", "Replaces OE Number", "Attention Needed", "Replaces Partslink Number", "Warranty", "Returns Policy", "Condition", "Deals", "Series", "Vehicle Body Type", "Oil Type", "Refrigerant Type"];
        const includedTitles = ["Certification", "Part", "Position", "Material", "Finish", "Lens Color", "Housing Color", "Light Source", "Assembly", "Quantity Sold"];

        const blockedParts = ["Pipe", "Exhaust Pipe", "Emblem", "Air Intake System", "Diesel Particulate Filter", "Conversion Kit"];

        function adjustPosition(position) {
            return position.replace("Location", "Position");
        }

        function processSingleProductInfo(productInfo) {
            let lines = productInfo.trim().split("\n");
            let productDict = {};
            let currentTitle = null;

            // Processing each line: first line is the Title, second line is the Info
            for (let i = 0; i < lines.length; i += 2) {
                let title = lines[i].trim().replace(":", "").trim(); // Clean up tab spaces or extra spaces
                let info = lines[i + 1]?.trim() || "N/A";

                // Skip titles with info containing "OE"
                if (info.includes("OE")) continue;

                // Adjust title if it's "Location"
                if (title === "Location") {
                    title = "Position";
                }

                // If title and info are the same, only use the info
                if (title === info) {
                    productDict[title] = info;
                } else if (!excludedTitles.includes(title)) {
                    productDict[title] = `${title}: ${info}`;
                }
            }

            // Handling blocked parts
            if (blockedParts.includes(productDict["Part"])) {
                alert(`The part provided is not allowed: ${productDict["Part"]}`);
                return null;
            }

            // Create the processed entry, leaving "Notes" and "Quantity Sold" at the end
            let processedEntry = includedTitles.reduce((acc, title) => {
                acc[title] = productDict[title] || "N/A";
                return acc;
            }, {});

            let additionalData = Object.entries(productDict).filter(([key]) => !includedTitles.includes(key)).map(([key, value]) => value);

            // Ensure the last two columns are "Notes" and "Quantity Sold"
            let result = [
                processedEntry["Certification"], processedEntry["Part"], processedEntry["Position"], processedEntry["Material"],
                processedEntry["Finish"], processedEntry["Lens Color"], processedEntry["Housing Color"], processedEntry["Light Source"],
                processedEntry["Assembly"]
            ];

            // Fill Data 1-10 columns with available data or N/A
            for (let i = 0; i < 10; i++) {
                result.push(additionalData[i] || "N/A");
            }

            result[19] = productDict["Notes"] || "N/A"; // Notes column
            result[20] = productDict["Quantity Sold"] || "N/A"; // Quantity Sold column

            return result;
        }

        function processProductInfo() {
            let rawText = document.getElementById("productInfo").value.trim();
            let productInfos = rawText.split("\n\n"); 
            let allEntries = productInfos.map(processSingleProductInfo).filter(entry => entry !== null);

            let table = $('#productTable').DataTable({
                destroy: true,
                data: allEntries,
                order: [] // Disable initial sorting
            });
        }

        function copyToClipboard() {
            let table = $('#productTable').DataTable();
            let data = table.rows().data().toArray().map(row => row.join("\t")).join("\n");
            navigator.clipboard.writeText(data).then(() => {
                alert("Data copied to clipboard!");
            }).catch(() => {
                alert("Failed to copy data to clipboard.");
            });
        }

        $(document).ready(function () {
            $('#productTable').DataTable();
        });
    </script>
</body>
</html>
