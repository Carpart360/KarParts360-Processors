<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>USAUTO SET Info Processor</title>
    <link rel="stylesheet" href="https://cdn.datatables.net/1.11.5/css/jquery.dataTables.min.css">
    <style>
        body {
            background-color: #B0B0B0;
            font-family: Arial, sans-serif;
        }
        .container {
            padding: 20px;
	}
        .logo {
            display: block;
            margin: 0 auto 20px auto;
            max-width: 100%;
            height: auto;
        }
        textarea {
            width: 100%;
            height: 150px;
            margin-bottom: 10px;
        }
        button {
            background-color: #de9b14;
            color: black;
            padding: 10px;
            border: none;
            cursor: pointer;
            margin-right: 10px;
        }
        table {
            width: 100%;
        }
    </style>
</head>
<body>
    <div class="container">
	<img src="C:/Users/USER/Downloads/Logo.png" alt="Logo" class="logo">
        <h2>Enter Product Info:</h2>
        <textarea id="productInfo"></textarea><br>
        <button onclick="processProductInfo()">Process</button>
        <button onclick="copyToClipboard()">Copy to Clipboard</button>
        <table id="productTable" class="display">
            <thead>
                <tr>
                    <th>Certification</th>
                    <th>Components</th>
                    <th>Part</th>
                    <th>Position</th>
                    <th>Material</th>
                    <th>Finish</th>
                    <th>Lens Color</th>
                    <th>Housing Color</th>
                    <th>Light Source</th>
                    <th>Assembly</th>
                    <th>Data 1</th>
                    <th>Data 2</th>
                    <th>Data 3</th>
                    <th>Data 4</th>
                    <th>Data 5</th>
                    <th>Data 6</th>
                    <th>Data 7</th>
                    <th>Data 8</th>
                    <th>Data 9</th>
                    <th>Data 10</th>
                    <th>Notes</th>
                    <th>Quantity Sold</th>
                </tr>
            </thead>
            <tbody>
            </tbody>
        </table>
    </div>
    <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
    <script src="https://cdn.datatables.net/1.11.5/js/jquery.dataTables.min.js"></script>
    <script>
        const excludedTitles = ["Brand", "Product Fit", "Recommended Use", "Prop 65 Warning", "Interchange Part Number", "Replaces OE Number", "Replaces Partslink Number", "Warranty", "Returns Policy", "Condition", "Deals", "Vehicle Body Type", "Oil Type", "Refrigerant Type"];
        const includedTitles = ["Certification", "Components", "Part", "Position", "Material", "Finish", "Lens Color", "Housing Color", "Light Source", "Assembly", "Notes", "Quantity Sold"];
        const prefixes = ["Front", "Rear"];
        const middles = ["Driver and Passenger Side", "Driver Side", "Passenger Side"];
        const suffixes = ["Lower", "Upper", "Rearward", "Frontward", "Center", "Inner", "Outer"];

        const blockedParts = [
            "Pipe", "Exhaust Pipe", "Diverter Valve", "Test Pipe", "Cam Phaser", "Down Pipe", "Internal Parts of TESLA", "Race pipe", 
            "Emblem", "Air Intake System", "Viton", "EGR Cooler", "Blow Off Valve", "Seatbelt", "Cat-Back", "Tuner", "Airbag", 
            "Oxygen Sensor", "Malfunction indicator light eliminators", "Muffler", "Lexus Grille", "Toyota Tacoma Grille", "Rifle", 
            "Flash Hider", "HID Kit", "Underbed Box", "Tire", "Door Lock Opener", "Block-off plates", "Sparkplug non-fouler", 
            "Diesel Particulate Filter", "Conversion Kit", "Refrigerant Oil"
        ];

        const disregardedInfos = ["OE comparable", "OE Replacement"];

        function pluralize(word) {
            if (word.includes("Glass")) {
                return word.replace("Glass", "Glasses");
            }
            if (word.endsWith('s')) {
                return word;
            }
            return word + 's';
        }

        function adjustPosition(position) {
            position = position.replace("And", "and");
            let parts = position.split(", ");
            let prefix = parts.filter(part => prefixes.includes(part));
            let middle = parts.filter(part => middles.includes(part));
            let suffix = parts.filter(part => suffixes.includes(part));
            let adjustedPosition = '';

            if (prefix.length > 0) {
                adjustedPosition += prefix.join(" ");
            }
            if (middle.length > 0) {
                adjustedPosition += (adjustedPosition ? ', ' : '') + middle.join(" ");
            }
            if (suffix.length > 0) {
                adjustedPosition += (adjustedPosition ? ', ' : '') + suffix.join(" ");
            }

            return adjustedPosition;
        }

        function processSingleProductInfo(productInfo) {
            let lines = productInfo.trim().split("\n");
            let productDict = {};
            let currentTitle = null;

            lines.forEach(line => {
                if (line.endsWith(":")) {
                    currentTitle = line.slice(0, -1);
                    if (currentTitle === "Location") currentTitle = "Position";
                } else if (currentTitle && !excludedTitles.includes(currentTitle) && !disregardedInfos.includes(line)) {
                    if (currentTitle === "Part") {
                        if (line === "Mirror") {
                            productDict[currentTitle] = "Door Mirror";
                        } else {
                            productDict[currentTitle] = pluralize(line);
                        }
                    } else {
                        productDict[currentTitle] = line;
                    }
                }
            });

            if (blockedParts.includes(productDict["Part"])) {
                alert(`The Part provided is NOT for listing:\n${productDict["Part"]}`);
                return null;
            }

            let processedEntry = includedTitles.reduce((acc, title) => ({ ...acc, [title]: "N/A" }), {});
            let additionalData = Array(10).fill("N/A");
            let additionalIndex = 0;

            for (let [title, info] of Object.entries(productDict)) {
                if (title === "Position") {
                    info = adjustPosition(info);
                }
                if (title === "Certification") {
                    processedEntry[title] = info;
                } else if (includedTitles.includes(title)) {
                    processedEntry[title] = title === info ? info : `${title}: ${info}`;
                } else if (!excludedTitles.includes(title) && additionalIndex < 10) {
                    additionalData[additionalIndex] = title === info ? info : `${title}: ${info}`;
                    additionalIndex++;
                }
            }

            return [
                processedEntry["Certification"], processedEntry["Components"], processedEntry["Part"], processedEntry["Position"], processedEntry["Material"],
                processedEntry["Finish"], processedEntry["Lens Color"], processedEntry["Housing Color"], processedEntry["Light Source"], processedEntry["Assembly"]
            ].concat(additionalData, [processedEntry["Notes"], processedEntry["Quantity Sold"]]);
        }

        function processProductInfo() {
            let rawText = document.getElementById("productInfo").value.trim();
            if (!rawText) {
                alert("Please enter Product Info.");
                return;
            }

            let productInfos = rawText.split("\n\n"); // Split the input into multiple sets of product info
            let allEntries = productInfos.map(processSingleProductInfo).filter(entry => entry !== null);

            let table = $('#productTable').DataTable();
            table.clear().rows.add(allEntries).draw();
        }

        function copyToClipboard() {
            let table = $('#productTable').DataTable();
            let data = table.rows().data().toArray().map(row => row.join("\t")).join("\n");
            navigator.clipboard.writeText(data).then(() => {
                alert("Data copied to clipboard!");
            }).catch(() => {
                alert("Failed to copy data to clipboard.");
            });
        }

        $(document).ready(function () {
            $('#productTable').DataTable();
        });
    </script>
</body>
</html>
