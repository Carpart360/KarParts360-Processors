<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>XCart Specifications Generator</title>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.17.4/xlsx.full.min.js"></script>
  <style>
    /* Global styles */
    body {
      background-color: #DBDBDB;      /* Light dark gray background */
      font-family: Arial, sans-serif; /* Global font set to Arial */
      margin: 0 25px;                 /* Add left/right margins to reduce cramped look */
      padding: 0;
    }

    /* Header container with logo and header text */
    .header-container {
      text-align: center;
      margin: 20px 0;
    }
    .company-logo {
      width: 300px;   /* Adjust the logo width as needed */
      height: auto;   /* Maintain aspect ratio */
      display: block;
      margin: 0 auto 20px auto; /* 20px bottom margin */
      filter: drop-shadow(2px 2px 4px rgba(0,0,0,0.3));
    }
    .main-header {
  font-family: 'Impact', sans-serif; /* Header remains Impact */
  font-size: 3.15em; /* Adjust as needed */
  color: #414141; /* Text fill color */
  -webkit-text-stroke: 0.2px #ffbb00; /* Text outline */
  letter-spacing: 0.05em; /* Increase spacing between letters */
  text-shadow: 2px 2px 4px rgba(0, 0, 0, 0.3);
  margin-top: 20px; /* 20px top margin */
    }

    /* Rounded corners for info boxes */
    .info-box { 
      margin: 15px 0; 
      padding: 10px; 
      border: 3.2px solid #A57900; 
      background-color: #FFBB00;
      color: #000000; 
      border-radius: 8px; /* Round corners of info boxes */
    }

    /* Rounded corners for the SKU list container */
    .sku-list {
  max-height: 500px;
  overflow-y: auto;
  margin-top: 5px;
  padding: 5px;
  background-color: #FFFFFF;
  border: 1px solid #c0c0c0;
  border-radius: 8px;
  resize: vertical; /* Allows vertical resizing only */
    }

    /* Rounded corners for input fields, file inputs, etc. */
    input[type="text"],
    input[type="file"],
    button,
    select,
    textarea {
      border-radius: 3px; /* Slight rounding of input corners */
    }

    /* Table styling with rounded corners */
    table {
      border-collapse: separate; 
      border-spacing: 0; 
      width: 100%; 
      border-radius: 6px;    /* Round the table's corners */
      overflow: hidden;      /* Ensures corners remain clipped */
    }
    th, td { 
      border: 1px solid black; 
      padding: 8px; 
      text-align: left; 
    }
    th { 
      background-color: #c0c0c0; 
    }

    /* Status messages */
    .status {
      margin: 10px 0;
      padding: 8px;
      border-radius: 4px;
    }
    .success { 
      background-color: #B3F0C1; 
      color: #155724; 
    }
    .error { 
      background-color: #f8d7da; 
      color: #721c24; 
    }

    .entry-count {
      font-weight: bold;
      margin-bottom: 5px;
    }

    .sku-item {
      margin: 5px 0;
      padding: 5px;
      background-color: #f0f0f0;
      border-radius: 3px;
      display: flex;
      justify-content: space-between;
      align-items: center;
    }
    .sku-checkbox, .attribute-checkbox {
      accent-color: green;  /* Checkboxes emit green */
      margin-right: 10px;
    }
    .sku-remove {
      color: #dc3545;
      cursor: pointer;
      font-weight: bold;
    }
    .attribute-summary {
      margin-top: 15px;
      background-color: #c0c0c0;
      padding: 10px;
      border-radius: 8px; /* Round corners for the attribute summary box too */
    }
    .attribute-item {
      padding: 3px;
      margin: 2px 0;
      display: flex;
      align-items: center;
    }
    .attribute-text {
      outline: none;
    }
    .search-container {
      display: flex;
      align-items: center;
      margin-bottom: 10px;
    }
    .search-container input {
      flex-grow: 1;
      margin-right: 10px;
    }
    .button-container {
      margin-top: 10px;
    }
  </style>
</head>
<body>
  <!-- Logo and header -->
  <div class="header-container">
    <!-- Replace the src below with your company logo path -->
    <img src="C:\Users\PC 7\Desktop\Processors\Logo.png" alt="Company Logo" class="company-logo">
    <h2 class="main-header">XCART SPECIFICATIONS GENERATOR</h2>
  </div>
  
  <!-- File Uploads -->
  <label>Upload Product Specifications File:</label>
  <input type="file" id="uploadSpecs" accept=".xlsx, .xls, .csv"><br><br>
  
  <label>Upload SKU File:</label>
  <input type="file" id="uploadSKU" accept=".xlsx, .xls, .csv"><br><br>
  
  <!-- Inventory Search -->
  <div class="search-container">
    <label for="searchInventory">Enter Inventory Number:</label>
    <input type="text" id="searchInventory">
    <button onclick="searchSKUs()">Search</button>
  </div>
  
  <!-- Buttons -->
  <div class="button-container">
    <button onclick="processInventoryNumber()">Process</button>
    <button onclick="addToEntry()">Add to Entry</button>
    <button onclick="generateFullResult()">Generate Full Result</button>
    <button onclick="copyToClipboard()">Copy to Clipboard</button>
    <button onclick="clearEntries()">Clear Entries</button>
  </div>
  
  <!-- Status Message -->
  <div id="statusMessage" class="status" style="display: none;"></div>
  
  <!-- SKU Information Box -->
  <div id="skuInfoBox" class="info-box" style="display: none;">
    <div id="skuCount"></div>
    <div>
      <button onclick="selectAllSKUs(true)">Select All</button>
      <button onclick="selectAllSKUs(false)">Deselect All</button>
    </div>
    <div id="skuList" class="sku-list"></div>
    <div id="attributeSummary" class="attribute-summary" style="display: none;">
      <h4>Common Attributes:</h4>
      <div id="attributeList"></div>
    </div>
  </div>
  
  <!-- Entries Information Box -->
  <div id="entriesInfoBox" class="info-box" style="display: none;">
    <div id="entriesCount" class="entry-count"></div>
    <div id="entriesList" class="sku-list"></div>
  </div>
  
  <!-- Generated Table -->
  <h3>Generated Table:</h3>
  <table id="outputTable">
    <thead>
      <tr>
        <th>productSKU</th>
        <th>type</th>
        <th>name</th>
        <th>class</th>
        <th>group</th>
        <th>owner</th>
        <th>value</th>
        <th>default</th>
      </tr>
    </thead>
    <tbody></tbody>
  </table>
  
  <!-- JavaScript Code -->
  <script>
    let productSpecsData = [];
    let skuData = [];
    let storedEntries = [];
    let savedInventoryNumbers = [];
    let currentSKUs = [];
    
    const groupMapping = { 
      "Position": "Details",
"Lighting Technology": "Details",
"Lens Color": "Details",
"Housing Color": "Details",
"Color/Finish": "Details",
"Glass Adjustment Method": "Details",
"Heated Mirror": "Details",
"Foldable": "Details",
"Towing Mirror": "Details",
"Material": "Details",
"Surface Finish": "Details",
"Outer Material": "Details",
"Product Fit": "Details",
"Type": "Details",
"Features": "Details",
"Universal Fitment": "Details",
"Recommended Use": "Details",
"Light Source": "Details",
"Operation": "Details",
"Series": "Details",
"Design": "Details",
"Finish": "Details",
"Transmission": "Details",
"Accessories Included": "Details",
"Anti-pinch Motor": "Details",
"Attachment Method": "Details",
"Automatic Dimming Included": "Details",
"Back-up Lamp Bulb Included": "Details",
"Back-up Lamp Bulb Type": "Details",
"Blind Spot Indicator": "Details",
"Blind Spot Mirror Included": "Details",
"Bottom Header": "Details",
"Brake Lamp Bulb Included": "Details",
"Brake Lamp Bulb Type": "Details",
"Built-in Dryer": "Details",
"Built-in Oil Cooler": "Details",
"Built-in Receiver/dryer": "Details",
"Bulb Type": "Details",
"Bulbs Included": "Details",
"California Proposition 65": "Compliance",
"Cfm Type": "Details",
"Components Included": "Details",
"Configuration": "Details",
"Connector Pins Qty On Main Connector": "Details",
"Connector Quantity": "Details",
"Connector Terminal Quantity": "Details",
"Connector Type": "Details",
"Control Module": "Details",
"Cooler Included": "Details",
"Core Height": "Dimension",
"Core Length": "Dimension",
"Core Size": "Dimension",
"Core Thickness": "Dimension",
"Cornering Lamp Bulb Type": "Dimension",
"Cornering Lamp Included": "Dimension",
"Current": "Dimension",
"Daytime Running Light Bulb Included": "Dimension",
"Daytime Running Light Bulb Type": "Dimension",
"Energy Output": "Dimension",
"Engine Oil Cooler Fittings Distance Apart": "Dimension",
"Engine Oil Cooler Included": "Dimension",
"Engine Oil Cooler Inlet Fitting Gender": "Dimension",
"Engine Oil Cooler Outlet Fitting Gender": "Dimension",
"Engine Oil Cooler Type": "Dimension",
"Eoc Distance": "Dimension",
"Eoc Inlet Diameter": "Dimension",
"Eoc Inlet Type": "Details",
"Eoc Outlet Diameter": "Dimension",
"Eoc Outlet Type": "Details",
"Fan Blade Material": "Details",
"Fan Type": "Details",
"Fin Count": "Dimension",
"Fin Height": "Dimension",
"Fin Wave Height": "Dimension",
"Find Wave Pitch": "Details",
"Flow Configuration": "Details",
"Fog Light Bulb Included": "Details",
"Fog Light Bulb Type": "Details",
"Front Side Marker Light Bulb Included": "Details",
"Front Side Marker Light Bulb Type": "Details",
"Front Signal Light Bulb Included": "Details",
"Front Signal Light Bulb Type": "Details",
"Glass Type": "Details",
"Hardware Included": "Details",
"Housing Material": "Details",
"Inlet Connection Type": "Details",
"Inlet Diameter": "Dimension",
"Inlet Fitting Design": "Details",
"Inlet Size": "Dimension",
"Installation Instructions Included": "Details",
"Lens Material": "Details",
"Manual Remote": "Details",
"Memory": "Details",
"Mirror Turn Signal Indicator": "Details",
"Mirror Type": "Details",
"Motor Included": "Details",
"Motor Type": "Details",
"Mounting Position": "Details",
"No. Of Rows": "Details",
"Noise": "Details",
"Notes 1": "Notes",
"Notes 2": "Notes",
"Notes 3": "Notes",
"Oe Manufacturer": "Details",
"One Touch": "Details",
"Other Side": "Details",
"Outlet Connection Type": "Details",
"Outlet Diameter": "Dimension",
"Outlet Fitting Design": "Details",
"Outlet Size": "Dimension",
"Package Contents": "Details",
"Park Lamp Bulb Included": "Details",
"Park Lamp Bulb Type": "Details",
"Power": "Details",
"Product Color": "Details",
"Puddle Light Included": "Details",
"Rear Fog Lamp Bulb Included": "Details",
"Rear Fog Lamp Bulb Type": "Details",
"Rear Side Marker Lamp Bulb Included": "Details",
"Rear Side Marker Lamp Bulb Type": "Details",
"Rear Turn Signal Bulb Included": "Details",
"Rear Turn Signal Bulb Type": "Details",
"Regulator Position": "Details",
"Remarks": "Details",
"Rotation Direction": "Details",
"Rows": "Dimension",
"Shroud Included": "Details",
"Shroud Material": "Details",
"Side Repeater Light Bulb Type": "Details",
"Side Repeater Light Included": "Details",
"Side View Camera Included": "Details",
"Stall Speed Rpm": "Details",
"Tail Lamp Bulb Included": "Details",
"Tail Lamp Bulb Type": "Details",
"Tank Material": "Details",
"Toc Distance": "Dimension",
"Toc Inlet Diameter": "Dimension",
"Toc Inlet Fitting Design": "Details",
"Toc Inlet Type": "Details",
"Toc Outlet Diameter": "Dimension",
"Toc Outlet Fitting Design": "Details",
"Toc Outlet Type": "Details",
"Top Header": "Details",
"Total Fin Row Count": "Details",
"Total Tube Count": "Details",
"Transmission Oil Cooler Distance Between Fittings": "Details",
"Transmission Oil Cooler Included": "Details",
"Transmission Oil Cooler Type": "Details",
"Tube Count": "Dimension",
"Tube Width X Height": "Dimension",
"Mounting Type": "Details",
"Upper Temperature Rating": "Details",
"Measuring Range": "Details",
"Style Name": "Details",
"TPMS Sensor Type": "Details",
"TPMS Sensor Frequency": "Details",
"Voltage": "Details",
"Fuel Level Sensor Resitance Range": "Details",
"Fuel Tank Gasket Included": "Details",
"Fuel Tube Connection Type": "Details",
"Gph": "Details",
"Maximum Air Pressure": "Details",
"Strainer Included": "Details",
"Driving Light Bulb Included": "Details",
"Driving Light Bulb Type": "Details",
"High Beam Bulb Included": "Details",
"High Beam Bulb Type": "Details",
"Low Beam Bulb Included": "Details",
"Low Beam Bulb Type": "Details",
"Sae/dot Compliant": "Details",
"Hid Ballast Included": "Details",
"Afs Motor": "Details",
"Auto-lever Motor": "Details",
"Led Controller Included": "Details",
"LED Headlight Control Module": "Details",
"Clearance Lamp Bulb Included": "Details",
"Clearance Lamp Bulb Type": "Details",
"W/ Cover": "Details",
"W/ Socket": "Details",
"Fan Position": "Details",
"Power Generation": "Details",
"Pully Wheel Design": "Details",
"Pully Wheel Grooves": "Details"
      // Add more mappings as needed
    };
    
    document.getElementById("uploadSpecs").addEventListener("change", handleProductSpecsUpload);
    document.getElementById("uploadSKU").addEventListener("change", handleSKUUpload);
    
    function handleProductSpecsUpload(event) {
      readExcelFile(event.target.files[0], data => {
        productSpecsData = data;
        showStatus("Product Specifications File Loaded!", "success");
      });
    }
    
    function handleSKUUpload(event) {
      readExcelFile(event.target.files[0], data => {
        skuData = data;
        showStatus("SKU File Loaded!", "success");
      });
    }
    
    function readExcelFile(file, callback) {
      const reader = new FileReader();
      reader.onload = function (e) {
        const data = new Uint8Array(e.target.result);
        const workbook = XLSX.read(data, { type: "array" });
        const sheetName = workbook.SheetNames[0];
        const jsonData = XLSX.utils.sheet_to_json(workbook.Sheets[sheetName], { header: 1 });
        callback(jsonData);
      };
      reader.readAsArrayBuffer(file);
    }
    
    function showStatus(message, type) {
      const statusDiv = document.getElementById("statusMessage");
      statusDiv.textContent = message;
      statusDiv.className = "status " + type;
      statusDiv.style.display = "block";
      setTimeout(() => {
        statusDiv.style.display = "none";
      }, 3000);
    }
    
    function clearTable() {
      document.getElementById("outputTable").querySelector("tbody").innerHTML = "";
    }
    
    function selectAllSKUs(select) {
      const checkboxes = document.querySelectorAll('.sku-checkbox');
      checkboxes.forEach(checkbox => {
        checkbox.checked = select;
      });
    }
    
    /* 
       The attribute summary includes a green checkbox and editable text.
       Rounded corners are handled by the CSS .attribute-summary class. 
    */
    function updateAttributeSummary(attributes) {
      const attributeSummary = document.getElementById("attributeSummary");
      const attributeList = document.getElementById("attributeList");
      
      if (!attributes || attributes.length === 0) {
        attributeSummary.style.display = "none";
        return;
      }
      
      attributeList.innerHTML = "";
      attributes.forEach(attr => {
        const attrItem = document.createElement("div");
        attrItem.className = "attribute-item";
        
        const checkbox = document.createElement("input");
        checkbox.type = "checkbox";
        checkbox.className = "attribute-checkbox";
        checkbox.checked = true;
        
        const span = document.createElement("span");
        span.className = "attribute-text";
        span.contentEditable = true;
        span.textContent = `${attr.name}: ${attr.value}`;
        
        attrItem.appendChild(checkbox);
        attrItem.appendChild(span);
        attributeList.appendChild(attrItem);
      });
      
      attributeSummary.style.display = "block";
    }
    
    // Returns the currently checked attributes (with edited text).
    function getSelectedAttributes() {
      const attributeList = document.getElementById("attributeList");
      let selectedAttributes = [];
      const items = attributeList.getElementsByClassName("attribute-item");
      for (let i = 0; i < items.length; i++) {
        const checkbox = items[i].querySelector(".attribute-checkbox");
        const span = items[i].querySelector(".attribute-text");
        if (checkbox && checkbox.checked) {
          const text = span.textContent;
          const parts = text.split(":");
          let name = parts[0].trim();
          let value = parts.slice(1).join(":").trim();
          selectedAttributes.push({ name, value });
        }
      }
      return selectedAttributes;
    }
    
    function updateSKUInfo(uniqueSKUs, attributes) {
      const skuInfoBox = document.getElementById("skuInfoBox");
      const skuCount = document.getElementById("skuCount");
      const skuList = document.getElementById("skuList");
      
      if (uniqueSKUs.length === 0) {
        skuInfoBox.style.display = "none";
        return;
      }
      
      currentSKUs = uniqueSKUs;
      
      skuCount.textContent = `Found ${uniqueSKUs.length} unique SKU${uniqueSKUs.length > 1 ? 's' : ''}:`;
      
      skuList.innerHTML = "";
      uniqueSKUs.forEach(sku => {
        const skuItem = document.createElement("div");
        skuItem.className = "sku-item";
        
        const checkbox = document.createElement("input");
        checkbox.type = "checkbox";
        checkbox.className = "sku-checkbox";
        checkbox.value = sku;
        checkbox.checked = true;
        
        const label = document.createElement("span");
        label.textContent = sku;
        
        const removeBtn = document.createElement("span");
        removeBtn.textContent = "Ã—";
        removeBtn.className = "sku-remove";
        removeBtn.onclick = function() {
          skuItem.remove();
          const remainingSKUs = document.querySelectorAll('.sku-checkbox').length;
          skuCount.textContent = `Found ${remainingSKUs} unique SKU${remainingSKUs > 1 ? 's' : ''}:`;
        };
        
        skuItem.appendChild(checkbox);
        skuItem.appendChild(label);
        skuItem.appendChild(removeBtn);
        skuList.appendChild(skuItem);
      });
      
      updateAttributeSummary(attributes);
      
      skuInfoBox.style.display = "block";
    }
    
    function searchSKUs() {
      const inventoryNumber = document.getElementById("searchInventory").value.trim();
      if (!inventoryNumber) {
        showStatus("Please enter an inventory number", "error");
        return;
      }
      
      if (productSpecsData.length === 0 || skuData.length === 0) {
        showStatus("Please upload both Product Specifications and SKU files first", "error");
        return;
      }
      
      clearTable();
      
      const [uniqueSKUs, uniqueAttributes] = findMatchingSKUs(inventoryNumber);
      
      if (uniqueSKUs.length === 0) {
        showStatus(`No matching SKU found for inventory number ${inventoryNumber}`, "error");
        return;
      }
      
      updateSKUInfo(uniqueSKUs, uniqueAttributes);
      
      showStatus(`Found ${uniqueSKUs.length} matching SKUs for inventory number ${inventoryNumber}`, "success");
    }
    
    function findMatchingSKUs(inventoryNumber) {
      let matchingSpec = null;
      for (let i = 1; i < productSpecsData.length; i++) {
        if (productSpecsData[i][0] && productSpecsData[i][0].toString() === inventoryNumber) {
          matchingSpec = productSpecsData[i];
          break;
        }
      }
      
      if (!matchingSpec) {
        return [[], []];
      }
      
      let matchedSKUs = [];
      for (let i = 1; i < skuData.length; i++) {
        if (skuData[i][0] && skuData[i][0].toString().includes(`-${inventoryNumber}-`)) {
          matchedSKUs.push(skuData[i]);
        }
      }
      
      let uniqueSKUs = [...new Set(matchedSKUs.map(row => row[0]))];
      
      let uniqueAttributes = [];
      let attributeValues = {};
      
      matchedSKUs.forEach(skuRow => {
        for (let i = 1; i < skuRow.length; i += 2) {
          let name = skuRow[i];
          let value = skuRow[i + 1] || "";
          
          if (name && value) {
            if (attributeValues[name] === undefined) {
              attributeValues[name] = value;
              uniqueAttributes.push({ name, value });
            } else if (attributeValues[name] !== value) {
              console.warn(`Different values found for attribute "${name}": "${attributeValues[name]}" and "${value}"`);
            }
          }
        }
      });
      
      return [uniqueSKUs, uniqueAttributes];
    }
    
    function processInventoryNumber() {
      const inventoryNumber = document.getElementById("searchInventory").value.trim();
      if (!inventoryNumber) {
        showStatus("Please enter an inventory number", "error");
        return;
      }
      
      const selectedSKUs = getSelectedSKUs();
      if (selectedSKUs.length === 0) {
        showStatus("No SKUs selected. Please search for an inventory number and select SKUs first.", "error");
        return;
      }
      
      clearTable();
      
      let matchingSpec = null;
      for (let i = 1; i < productSpecsData.length; i++) {
        if (productSpecsData[i][0] && productSpecsData[i][0].toString() === inventoryNumber) {
          matchingSpec = productSpecsData[i];
          break;
        }
      }
      
      if (!matchingSpec) {
        showStatus(`Inventory Number ${inventoryNumber} not found in Product Specifications File`, "error");
        return;
      }
      
      generateTablePreview(inventoryNumber, selectedSKUs, getSelectedAttributes());
      
      showStatus(`Generated preview for ${selectedSKUs.length} SKUs`, "success");
    }
    
    function getSelectedSKUs() {
      const checkboxes = document.querySelectorAll('.sku-checkbox:checked');
      return Array.from(checkboxes).map(cb => cb.value);
    }
    
    function addToEntry() {
      const inventoryNumber = document.getElementById("searchInventory").value.trim();
      if (!inventoryNumber) {
        showStatus("Please enter an inventory number to add to entries", "error");
        return;
      }
      
      const existingIndex = savedInventoryNumbers.findIndex(entry => entry.inventory === inventoryNumber);
      if (existingIndex !== -1) {
        showStatus("This inventory number is already saved", "error");
        return;
      }
      
      const selectedSKUs = getSelectedSKUs();
      if (selectedSKUs.length === 0) {
        showStatus("No SKUs selected. Please search for an inventory number and select SKUs first.", "error");
        return;
      }
      
      const selectedAttributes = getSelectedAttributes();
      
      savedInventoryNumbers.push({
        inventory: inventoryNumber,
        skus: selectedSKUs,
        attributes: selectedAttributes
      });
      
      showStatus(`Inventory number ${inventoryNumber} added to entries with ${selectedSKUs.length} SKUs`, "success");
      
      updateEntriesInfo();
      document.getElementById("searchInventory").value = "";
      clearTable();
      document.getElementById("skuInfoBox").style.display = "none";
    }
    
    function clearEntries() {
      if (savedInventoryNumbers.length === 0) {
        showStatus("No entries to clear", "error");
        return;
      }
      
      savedInventoryNumbers = [];
      storedEntries = [];
      clearTable();
      document.getElementById("entriesInfoBox").style.display = "none";
      document.getElementById("skuInfoBox").style.display = "none";
      
      showStatus("All entries have been cleared", "success");
    }
    
    function generateFullResult() {
      if (savedInventoryNumbers.length === 0) {
        showStatus("No inventory numbers saved. Please add entries first.", "error");
        return;
      }
      
      clearTable();
      storedEntries = [];
      
      let allUniqueSKUs = [];
      
      savedInventoryNumbers.forEach(entry => {
        generateTableRows(entry.inventory, entry.skus, entry.attributes);
        allUniqueSKUs = [...allUniqueSKUs, ...entry.skus];
      });
      
      allUniqueSKUs = [...new Set(allUniqueSKUs)];
      
      const skuInfoBox = document.getElementById("skuInfoBox");
      const skuCount = document.getElementById("skuCount");
      skuCount.textContent = `Generated results for ${allUniqueSKUs.length} unique SKUs`;
      skuInfoBox.style.display = "block";
      document.getElementById("attributeSummary").style.display = "none";
      document.getElementById("skuList").innerHTML = "";
      
      showStatus(`Generated results for ${savedInventoryNumbers.length} inventory entries`, "success");
    }
    
    function generateTablePreview(inventoryNumber, skus, attributes) {
      const resultTable = document.getElementById("outputTable").querySelector("tbody");
      resultTable.innerHTML = "";
      
      let matchingSpec = null;
      for (let i = 1; i < productSpecsData.length; i++) {
        if (productSpecsData[i][0] && productSpecsData[i][0].toString() === inventoryNumber) {
          matchingSpec = productSpecsData[i];
          break;
        }
      }
      
      if (!matchingSpec) return;
      
      let className = matchingSpec[1] || "";
      let specifications = [];
      for (let i = 2; i < matchingSpec.length; i++) {
        if (matchingSpec[i] && String(matchingSpec[i]).trim() !== "") {
          let header = productSpecsData[0][i] || "";
          specifications.push({ name: header, value: String(matchingSpec[i] || "") });
        }
      }
      
      skus.forEach(productSKU => {
        let yesEntries = [];
        let noEntries = [];
        
        attributes.forEach(attr => {
          yesEntries.push([productSKU, "T", attr.name, className, "", "Yes", attr.value, "Yes"]);
        });
        
        specifications.forEach(spec => {
          let group = groupMapping[spec.name] || "";
          noEntries.push([productSKU, "T", spec.name, className, group, "No", spec.value, "No"]);
        });
        
        [...yesEntries, ...noEntries].forEach(row => {
          resultTable.innerHTML += `<tr>${row.map(cell => `<td>${cell}</td>`).join("")}</tr>`;
        });
      });
    }
    
    function generateTableRows(inventoryNumber, skus, attributes) {
      let matchingSpec = null;
      for (let i = 1; i < productSpecsData.length; i++) {
        if (productSpecsData[i][0] && productSpecsData[i][0].toString() === inventoryNumber) {
          matchingSpec = productSpecsData[i];
          break;
        }
      }
      
      if (!matchingSpec) return;
      
      let className = matchingSpec[1] || "";
      let specifications = [];
      for (let i = 2; i < matchingSpec.length; i++) {
        if (matchingSpec[i] && String(matchingSpec[i]).trim() !== "") {
          let header = productSpecsData[0][i] || "";
          specifications.push({ name: header, value: String(matchingSpec[i] || "") });
        }
      }
      
      const resultTable = document.getElementById("outputTable").querySelector("tbody");
      
      skus.forEach(productSKU => {
        let yesEntries = [];
        let noEntries = [];
        
        attributes.forEach(attr => {
          yesEntries.push([productSKU, "T", attr.name, className, "", "Yes", attr.value, "Yes"]);
        });
        
        specifications.forEach(spec => {
          let group = groupMapping[spec.name] || "";
          noEntries.push([productSKU, "T", spec.name, className, group, "No", spec.value, "No"]);
        });
        
        [...yesEntries, ...noEntries].forEach(row => {
          storedEntries.push(row);
          resultTable.innerHTML += `<tr>${row.map(cell => `<td>${cell}</td>`).join("")}</tr>`;
        });
      });
    }
    
    function copyToClipboard() {
      if (storedEntries.length === 0) {
        showStatus("No data to copy. Please generate full results first.", "error");
        return;
      }
      
      const tsvContent = storedEntries.map(row => row.join("\t")).join("\n");
      
      const textarea = document.createElement("textarea");
      textarea.value = tsvContent;
      textarea.style.position = "fixed";
      document.body.appendChild(textarea);
      textarea.select();
      
      try {
        const successful = document.execCommand("copy");
        if (successful) {
          showStatus(`Copied ${storedEntries.length} rows to clipboard`, "success");
        } else {
          showStatus("Failed to copy data", "error");
        }
      } catch (err) {
        showStatus("Error copying data: " + err, "error");
      }
      
      document.body.removeChild(textarea);
    }
  </script>
</body>
</html>
