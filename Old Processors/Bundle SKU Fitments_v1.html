<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Excel Multi-Sheet Filtering</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.18.5/xlsx.full.min.js"></script>
    <style>
        body {
            background-color: #AEADAD;
            font-family: Arial, sans-serif;
            text-align: center;
        }
        h1 {
            text-align: center;
            text-transform: uppercase;
        }
        .logo {
            display: block;
            margin: 20px auto;
            width: 150px; /* Adjust the size here */
        }
        button {
            background-color: #F3A93A;
            border: none;
            padding: 10px 20px;
            color: white;
            font-size: 16px;
            cursor: pointer;
            border-radius: 5px;
            margin-top: 10px;
        }
        button:hover {
            opacity: 0.9;
        }
        label {
            font-size: 16px;
            margin-top: 10px;
            display: block;
        }
        input {
            padding: 8px;
            font-size: 14px;
            margin-top: 5px;
            width: 300px;
            text-align: center;
        }
        table {
            margin: 20px auto;
            border-collapse: collapse;
            width: 90%;
        }
        th, td {
            border: 1px solid #ddd;
            padding: 8px;
            text-align: left;
        }
        th {
            background-color: #F3A93A;
            color: white;
        }
        td {
            background-color: #FFFFFF; /* White background for data row cells */
        }
    </style>
</head>
<body>
    <img src="C:\Users\PC 7\Downloads\Processors\Default KarParts360 LOGO Version 3 1.png" alt="Logo" class="logo">
    <h1>Excel Multi-Sheet Filtering</h1>

    <label for="fileInput">Upload Excel File:</label>
    <input type="file" id="fileInput" accept=".xlsx, .xls">

    <label for="filterInput">Enter SKU:</label>
    <input type="text" id="filterInput" placeholder="Enter SKU">

    <button onclick="processFile()">Process</button>
    <button onclick="copyResults()">Copy Results</button>

    <h2>Filtered Results:</h2>
    <table id="resultsTable" border="1">
        <thead>
            <tr>
                <th>SKU</th>
                <th>Inventory Number</th>
                <th>Make</th>
                <th>Model</th>
                <th>Year</th>
                <th>Submodel</th>
            </tr>
        </thead>
        <tbody></tbody>
    </table>

    <script>
        function processFile() {
            const fileInput = document.getElementById("fileInput").files[0];
            const filterValue = document.getElementById("filterInput").value.toLowerCase();

            if (!fileInput) {
                alert("Please upload an Excel file.");
                return;
            }

            const reader = new FileReader();
            reader.onload = (event) => {
                const data = new Uint8Array(event.target.result);
                const workbook = XLSX.read(data, { type: 'array' });

                // Use the correct sheet names
                const sheet1 = XLSX.utils.sheet_to_json(workbook.Sheets["Bundle SKU"], { header: 1 });
                const sheet2 = XLSX.utils.sheet_to_json(workbook.Sheets["Fitment"], { header: 1 });

                filterAndDisplay(sheet1, sheet2, filterValue);
                alert("Filtering Complete!"); // Add pop-up after processing
            };

            reader.readAsArrayBuffer(fileInput);
        }

        function filterAndDisplay(sheet1, sheet2, filterValue) {
            const results = [];

            // Filter SKU in Sheet1 (Column 2)
            const filteredSheet1 = sheet1.slice(1).filter(row => {
                const sku = row[1] ? row[1].toString().trim().toLowerCase() : "";
                return sku === filterValue.trim();
            });

            console.log("Filtered Sheet1 Data:", filteredSheet1);

            // Match Sheet1 results with Sheet2 (Column 1)
            filteredSheet1.forEach(row1 => {
                const inventoryNumber = row1[0] ? row1[0].toString().trim() : ""; // Column 1 in Sheet1
                const sku = row1[1] ? row1[1].toString().trim() : ""; // Column 2 in Sheet1

                sheet2.slice(1).forEach(row2 => {
                    const sheet2Sku = row2[0] ? row2[0].toString().trim() : ""; // Column 1 in Sheet2
                    if (sheet2Sku === sku) { // Match SKU in Column 1 of Sheet2
                        results.push([
                            sku,
                            inventoryNumber,
                            row2[1] ? row2[1].toString() : "", // Make
                            row2[2] ? row2[2].toString() : "", // Model
                            row2[3] ? row2[3].toString() : "", // Year
                            row2[4] ? row2[4].toString() : ""  // Submodel
                        ]);
                    }
                });
            });

            console.log("Results:", results);
            displayResults(results);
        }

        function displayResults(results) {
            const tableBody = document.querySelector("#resultsTable tbody");
            tableBody.innerHTML = results.map(row =>
                `<tr>${row.map(cell => `<td>${cell || ''}</td>`).join('')}</tr>`
            ).join("");

            if (results.length === 0) {
                alert("No results found for the given SKU.");
            }
        }

        function copyResults() {
            const tableBody = document.querySelector("#resultsTable tbody");
            const rows = tableBody.querySelectorAll("tr");
            let textToCopy = "";

            rows.forEach(row => {
                const cells = row.querySelectorAll("td");
                const rowData = Array.from(cells).map(cell => cell.innerText).join("\t");
                textToCopy += rowData + "\n";
            });

            navigator.clipboard.writeText(textToCopy).then(() => {
                alert("Data rows copied to clipboard!");
            }).catch(err => {
                console.error("Error copying text: ", err);
            });
        }
    </script>
</body>
</html>
