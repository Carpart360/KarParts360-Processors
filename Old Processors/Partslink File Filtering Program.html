<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Partslink File Filtering Program</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.18.5/xlsx.full.min.js"></script>
    <style>
        body {
            background-color: #AEADAD;
            font-family: Arial, sans-serif;
            text-align: center;
        }
        h1 {
            text-align: center;
            text-transform: uppercase;
        }
        .logo {
            display: block;
            margin: 20px auto;
            width: 150px; /* Adjust the size here */
        }
        button {
            background-color: #F3A93A;
            border: none;
            padding: 10px 20px;
            color: white;
            font-size: 16px;
            cursor: pointer;
            border-radius: 5px;
            margin-top: 10px;
        }
        button:hover {
            opacity: 0.9;
        }
        label {
            font-size: 16px;
            margin-top: 10px;
            display: block;
        }
        input {
            padding: 8px;
            font-size: 14px;
            margin-top: 5px;
            width: 300px;
            text-align: center;
        }
        table {
            margin: 20px auto;
            border-collapse: collapse;
            width: 90%;
        }
        th, td {
            border: 1px solid #ddd;
            padding: 8px;
            text-align: left;
        }
        th {
            background-color: #F3A93A;
            color: white;
        }
        td {
            background-color: #FFFFFF; /* White background for data row cells */
        }
    </style>
</head>
<body>
    <img src="C:\Users\PC 7\Downloads\Processors\Default KarParts360 LOGO Version 3 1.png" alt="Logo" class="logo">
    <h1>Partslink File Filtering Program</h1>

    <label for="mainFile">Upload Main File:</label>
    <input type="file" id="mainFile" accept=".xlsx, .xls">

    <label for="filterInput">Enter Partslink:</label>
    <input type="text" id="filterInput" placeholder="Enter Partslink">

    <button onclick="processFiles()">Process</button>
    <button onclick="copyResults()">Copy Results</button>

    <h2>Filtered Results:</h2>
    <table id="resultsTable" border="1">
        <thead></thead>
        <tbody></tbody>
    </table>

    <script>
        let mainData = [];

        function readFile(file, callback) {
            const reader = new FileReader();
            reader.onload = (event) => {
                const data = new Uint8Array(event.target.result);
                const workbook = XLSX.read(data, { type: 'array' });
                const sheetName = workbook.SheetNames[0];
                const worksheet = workbook.Sheets[sheetName];
                const jsonData = XLSX.utils.sheet_to_json(worksheet, { header: 1 });
                callback(jsonData);
            };
            reader.readAsArrayBuffer(file);
        }

        function processFiles() {
            const mainFile = document.getElementById("mainFile").files[0];
            const filterValue = document.getElementById("filterInput").value.toLowerCase();

            if (!mainFile) {
                alert("Please upload the main file.");
                return;
            }

            readFile(mainFile, (main) => {
                mainData = main;
                filterAndDisplay(filterValue);
            });
        }

       function filterAndDisplay(filterValue) {
    if (!mainData.length) {
        alert("No data found in the uploaded file.");
        return;
    }

    const results = [];
    const headers = mainData[0]; // First row is the header

    mainData.slice(1).forEach(row => {
        const partslink = row[10]?.toString().toLowerCase(); // 11th column (PLINK)

        if (partslink && partslink.includes(filterValue)) {
            const fullRow = Array(headers.length).fill("");
            row.forEach((cell, index) => fullRow[index] = cell || "");
            results.push(fullRow);
        }
    });

    displayResults(headers, results);
}
        function displayResults(headers, results) {
            const tableHead = document.querySelector("#resultsTable thead");
            const tableBody = document.querySelector("#resultsTable tbody");

            tableHead.innerHTML = "<tr>" + headers.map(header => `<th>${header}</th>`).join("") + "</tr>";
            tableBody.innerHTML = results.map(row => 
                "<tr>" + row.map(cell => `<td>${cell || ''}</td>`).join("") + "</tr>"
            ).join("");

            alert("Filtering Complete!");
        }

        function copyResults() {
            const tableBody = document.querySelector("#resultsTable tbody");
            const rows = tableBody.querySelectorAll("tr");
            let textToCopy = "";

            rows.forEach(row => {
                const cells = row.querySelectorAll("td");
                const rowData = Array.from(cells).map(cell => cell.innerText).join("\t");
                textToCopy += rowData + "\n";
            });

            navigator.clipboard.writeText(textToCopy).then(() => {
                alert("Data rows copied to clipboard!");
            }).catch(err => {
                console.error("Error copying text: ", err);
            });
        }
    </script>
</body>
</html>
